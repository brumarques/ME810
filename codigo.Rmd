---
title: "Validari - Linearidade"
author: "Estatística 2017"
date: "11 de setembro de 2017"
header-includes:
   - \usepackage{bbm}
output: html_document

---
# Introdução

$\quad$ A Validari é uma *start up* que foi criada com o intuito de auxiliar os laboratórios farmacêuticos na validação de métodos analíticos. A proposta da empresa é criar um *software online*, que seja capaz de validar métodos analíticos de forma ágil e correta estatisticamente.  
$\quad$ O objetivo do nosso projeto é avaliar e revisar a metodologia usada para validação da Linearidade, explicando de forma clara o passo a passo da metodologia mais adequada.  


# Análise Descritiva   

$\quad$ A análise descritiva fornece resumos simples sobre a amostra e sobre as variáveis observadas. Tal resumo pode ser quantitativo ou visual.     
$\quad$ Como no caso de validação de métodos analíticos as variáveis são “concentração” e “área”, sabemos que elas são **positivos** e **não nulos**, ou seja, maiores que zero. Sugerimos, então, fazer um gráfico de dispersão e calcular as medidas resumo para começar a entender melhor como os dados se comportam.    
$\quad$ Pelo gráfico de dispersão (Figura 1), é possível observar como é a relação entre as variáveis, se há valores discrepantes ou se há alguma inconsistência nos dados (erro de digitação, por exemplo).   
$\quad$ Pelas medidas resumo (Tabela 1) verificamos se os valores tem as características esperadas. Tais medidas consistem em valores máximo e mínimo, média e desvio padrão, para cada uma das variáveis.    
$\quad$ Se houver suspeita de que algum valor não está correto,  deve-se realizar uma análise mais aprofundada sobre ele para confirmar, lembrando que **não** devemos retirar um valor da amostra, por mais que ele seja muito diferente dos demais, exceto quando há **certeza** de que foi um erro humano ou falha do equipamento. 

```{r, echo=FALSE, warning=FALSE}
library(readxl) #biblioteca para ler o excel
library(knitr)
data <- read_excel("C:/Users/TEMP/Downloads/data.xlsx") #leitura dos dados
plot(data, main="Gráfico de Dispersão", xlab="Concentração", ylab="Área") #grafico de dispersao

```

Figura 1: Gráfico de dispersão.

**Medidas Resumo**  


|        | Concentração | Área     |
|--------|--------------|----------|
| Mínimo | `r min(data$Concentração)`         | `r round(min(data$Área), 2)`  |
| Máximo | `r max(data$Concentração)`        | `r formatC(max(data$Área), digits = 7)` |
| Média  | `r mean(data$Concentração)`         | `r formatC(mean(data$Área), digits = 7)` |


Tabela 1: Medidas resumo dos dados.

# Regressão linear e significância dos parâmetros (curva analítica)  

Estatisticamente, a melhor forma de avaliar a linearidade é através da regressão linear, pois é a metodologia que estuda a relação entre uma variável de interesse (Área) e outras variáveis (Concentração). Com a regressão, vemos qual a melhor reta $(y=ax + b)$ a ser traçada que se ajusta melhor nesses dados, ou seja, qual reta faz com que a distância entre os pontos e a reta ajustada seja a menor possível, minimizando o erro e estimando com maior precisão, por isso a estimação é feita através do Método dos Mínimos Quadrados.  

```{r,echo=FALSE }
fit = lm(Área~Concentração, data=data)
plot(Área~Concentração, data=data, main="Curva Analítica")
abline(fit, col="red")
r= summary(fit)$r.squared

```

Figura 2: Gráfico de dispersão com a reta de regressão ajustada.


Na Figura 2, temos a reta de regressão (curva analítica) traçada em cima dos pontos. A reta encontrada foi:   
$$Y = `r format(coefficients(fit)[2], scientific=FALSE)`X + `r round(coefficients(fit)[1], 2)`$$
Ou seja, $a=`r format(coefficients(fit)[2], scientific=FALSE)`$ e $b=`r round(coefficients(fit)[1], 2)`$.   


# Qualidade de Ajuste Do Modelo

Após determinarmos a metodologia e ajustarmos o modelo, é necessário verificar a qualidade do ajuste do modelo aos dados. Algumas técnicas podem ser utilizadas, entre elas a  “análise de variância da regressão” (ANOVA), que é uma das mais utilizadas. 
Considerando o nosso exemplo, o resultado da ANOVA é mostrado na tabela 2:

| Parâmetro 	| Estimativa                                          	| p-valor                             	|
|-----------	|-----------------------------------------------------	|-------------------------------------	|
| a         	| `r  format(coefficients(fit)[2], scientific=FALSE)` 	| `r summary(fit)$coefficients[2,4]`  	|
| b         	| `r round(coefficients(fit)[1], 2)`                  	| `r summary(fit)$coefficients[1,4]`  	|    

Tabela 2: Tabela ANOVA- Estimativas e p-valor dos parâmetros da reta ajustada.

Para avaliar se a reta foi bem ajustada, ou seja, se os coeficientes da reta se ajustam bem aos pontos, vamos observar o p-valor. Ele nos mostra se cada coeficiente é significativo ou não para o modelo.
Dado que o nível de significância é 0.05, se:   
   <p> * P-valor < 0.05, há evidências para de que o parâmetro é significativo, ou seja, ele é diferente de zero, e a linearidade é aceita. <br />    
       * P-valor > 0,05, não há evidências para de que o parâmetro é significativo, ou seja, ele é igual a zero e não significativo para o modelo. Neste caso, a linearidade não é aceita. </p>  


# Diagnóstico do Modelo - Análise de Resíduos

Para verificar se a reta de regressão que foi ajustada satisfaz as suposições teóricas da metodologia estatística, devemos avaliar:

1. Independência dos resíduos  
Se há independência, os pontos devem estar distribuídos de forma aleatória no gráfico de resíduos vs valores ajustados, sem uma tendência de aumento ou diminuição de variabilidade, assim como na Figura 3.

```{r,echo=FALSE }
plot(fit$fitted.values,residuals(fit),ylab="Resíduos",xlab="Valores ajustados"); abline(h=0)
```

Figura 3: Gráfico de resíduos vs valores ajustados.

2. Homocedasticidade dos resíduos  
Precisamos verificar se há homocedasticidade, isto é, se a variância dos resíduos é constante. Uma forma de fazer isso é gerando o gráfico de resíduos padronizados vs ordem da coleta dos dados.  
Se os pontos estiverem distribuídos de forma aleatória e dentro dos limites, a homocedasticidade é satisfeita.

```{r,echo=FALSE }
respad <-rstandard(fit)
plot(respad, xlab="Ordem de coleta",ylab="Resíduos Padronizados")
lines(respad, lty=2)
abline(h=0)
abline(h=2,lty=2, col="blue")
abline(h=-2,lty=2,col="blue")

```

Figura 4: Gráfico de resíduos padronizados vs ordem de coleta.

3. Distribuição normal dos resíduos  
Se os resíduos têm distribuição normal, os pontos do gráfico devem estar próximos da reta, de forma aleatória, ou seja, não pode haver vários pontos seguidos abaixo da reta, por exemplo.

```{r,echo=FALSE }
qqnorm(residuals(fit),pch=20);qqline(residuals(fit))
```

Figura 5: QQ-plot

Se algum dos três itens acima não ocorrer, a linearidade não é satisfeita, uma vez que as suposições teóricas para ajuste da reta não são satisfeitas. Para o nosso exemplo, a linearidade é satisfeita, uma vez que a reta está bem ajustada e os resíduos satisfazem as suposições do modelo.


#Teste de Falta de Ajuste

O Teste Lack of Fit é um teste estatístico para avaliar a falta de ajuste em um modelo de regressão. O teste assume que a normalidade, independência e homocedasticiade da variância dos resíduos sejam válidos. Assim, após o ajuste e análise de resíduos, é importante verificar se o modelo linear é adequado.

```{r,echo=FALSE }
library(alr3)
pureErrorAnova(fit)
```


# Conclusão

Através de métodos estatísticos temos condição de validar a linearidade, partindo inicialmente com uma estatística descritiva para dar uma visão geral das concentrações e suas áreas , seguindo de uma regressão linear para nos mostrarmos estatisticamente a linearidade, concluindo com testes para verificação de alguns pontos importantes como independência, normalidade e homocedasticidade.  

```{r,echo=FALSE }

```



